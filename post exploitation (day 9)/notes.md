- post expoitation is like finding hay in a needlestack: it's painful

# CONTROL SOCKETS

- Two main ways to configure

### 1. Command Line Method:

```
ssh -M -S /tmp/s root@<IP ADDRESS> <TUNNEL COMMANDS -R or -L>
-o 'ControlPath=/tmp/s'
-M -S /tmp/s
```

#### Example
```
Connecting to your greyhost with control sockets

inethost >> `ssh -M -S /tmp/s student@10.50.31.225`
((enter password, will authenticate you))

inethost >> `ssh -o ControlPath=/tmp/s a`
```



### Modifying SSH Config file

```
>> vim ~/.ssh/config
((opens file))

  1 Host grey
  2     HostName 10.50.36.193
  3     User student
  4     ControlPath ~/.ssh/cm/grey
  5     ControlMaster auto              
  6     ControlPersist 30m     
  
((exit file))

>> mkdir ~/.ssh/grey
((now try it: use 'ssh grey', should take you to your greyhost now!))

vim ~/.ssh/config
((add the following: this will create new sockets for every new host you connect to!))
Host *
    ControlPath ~/.ssh/cm/%r@%h:%p
    ControlMaster auto
    ControlPersist auto
    
-------------------------------------------------------------------------------------------


now lets add tunnels to the mix. if we wanted to create sockets going towards a new pivot past the greyhost:

>> ssh grey -L 11101:192.168.28.120:4242    			##creating tunnel to the 192.x.x.x while using the 'grey' socket we made earlier
>> ssh student@localhost -p 11101 				##connecting to the tunnel we just made
>> ssh -o ControlPath='~/.ssh/cm/student@localhost:11101' a	##ssh to the new socket we made to the 192.x.x.x while also setting the control path. note the 'a' at the end: ubuntu needs additional words for some reason (weird right)	




```


### 2. Configuration File Method:

```
/ssh_config
HostName machine1.example.org
ControlPath ~/.ssh/controlmasters/%r@%h:%p
ControlMaster auto
ControlPersist 10m
```

### 3. Connecting to it w/ CLI Method


>> `ssh -o ControlPath=/tmp/s a`

=========================================================================================================================================================

# ENUMERATION

## USER ENUMERATION
- `net user`
- `cat /etc/passwd`

## PROCESS ENUMERATION
- `tasklist /v`
- `ps -elf`
- look for the following:
-  kaspersky
-  rk (rootkit) hunter
-  rsyslog ((rocket system log))
-  crontabs/cronjobs


## SERVICE ENUMERATION
- use the gui for windows
- or `tasklist /svc
- `chkconfig`

## NETWORK CONNECTION ENUMERATION
- `ip neigh`
- `ipconfig /all
- `ifconfig -a`
- `ip addr`

## CYBERCHEF ((look at these))
- base64
- rot13

## /etc/passwd | /etc/shadow
- root = zeus
- zeus is root privilige user!!! look at this for the test...



```
net user stuff
---------------
net user [username] /active:no		#disables account
net user [username] /active:yes
net user [username] [password] /add
net localgroup "Power Users" /add moe

powerusers
----------
two groups to worry about: remote desktop users && administrators



```


# CTFD



notes:

- check the share folder `/usr/share`
- check the hidden files in your directory (`.` in the front of it)
- 

```

Donovian Post Exploitation (DPE)
XX Mar 2024
Start Time: 1300
Duration: 4 hours

Type of Operation: Cyber Intelligence, Surveillance and Reconnaissance (C-ISR)

Objective: Maneuver through Donovian-Extranet, identify and gain access futher into Donovian internal Cyberspace, it is believed that there is an network that acts as an internal DMZ between these to locations. Intelligence was able to identify the last octet of a system that resides in the Donovian internal Cyberspace.

Tools/Techniques: All connections will be established through SSH masquerades or web browser. Ports in use will be dependent on target location and are subject to change. Network scanning tools/technique usage is at the discretion of student. Credential reuse is authorized

Scenario Credentials: FLAG = P05T3xpl01t5t@rtoF@ct1v1ty

Prior Approvals: Sudo usage and remote port forward is authorized. System dir walks from system roots, altering accounts/routing or tool uploads are authorized. Survey and access to newly discovered systems during C-ISR.

Scheme of Maneuver:
>internet_grey_host
->T1: 192.168.28.100
--->T3:x.x.x.9

Target Section:

T1
Hostname: Donovian_Extranet
IP: 192.168.28.100
OS: CentOS
Creds: comrade :: StudentMidwayPassword
Last Known SSH Port: 2222
PSP: none
Malware: none
Action: Perform SSH masquerade and survey system. Identify redirection to the next target.

T3
Hostname: unknown
IP: x.x.x.9
OS: unknown
Creds:unknown
Last Known SSH Port: unknown
PSP: Unknown
Malware: Unknown
Action: Gain access; survey host and map Donovian internal Cyberspace.
extranet 1:
map.png: 192.168.x.0/27 network

64 bytes from 192.168.28.97: icmp_seq=1 ttl=64 time=1.54 ms
64 bytes from 192.168.28.98: icmp_seq=1 ttl=64 time=1.55 ms
64 bytes from 192.168.28.99: icmp_seq=1 ttl=64 time=1.50 ms


scans
------
192.168.28.97
#all ports closed

Nmap scan report for 192.168.28.98
Host is up (0.0014s latency).
Not shown: 65534 closed ports
PORT   STATE SERVICE
53/tcp open  domain

Nmap scan report for 192.168.28.99
Host is up (0.0016s latency).
Not shown: 65534 closed ports
PORT   STATE SERVICE
53/tcp open  domain

Nmap done: 1 IP address (1 host up) scanned in 99.35 seconds

Nmap scan report for 192.168.28.100
Host is up (0.00094s latency).
Not shown: 65534 closed ports
PORT     STATE SERVICE
2222/tcp open  EtherNetIP-1 (actually ssh)

Nmap done: 1 IP address (1 host up) scanned in 72.72 seconds



192.168.28.130
53 tcp OPEN

192.168.28.131
53 tcp OPEN



cat /etc/hosts (for dns info)

192.168.150.253 Donovian-Intranet

Nmap scan report for 192.168.150.253
Host is up (0.0017s latency).
Not shown: 65532 closed ports
PORT     STATE SERVICE
80/tcp   open  http
514/tcp  open  shell          (rsyslog)
3201/tcp open  cpq-tasksmart        (SSH Port)



INTRANET
----------


cat /etc/hosts        #gives flag for dns

ls /etc/rsyslog.d       #look individually in these files

cat /etc/rsyslog.conf



getting root privs (you already ran sudo -l and saw you have the ability to sudo)

	1. create a text file in root's home directory
		> sudo vim /root/file.txt

	2. inside your vim, press ':' to enter command mode, then type the following
		!/bin/bash

	3. now look at who you are
		> root@lin

	4. now search through all your files/directories (particularly conf files)
		> ls -a
	
searching for antivirus
	focus on kaspersky, rkhunter
	
find / -type f -iname "*rkhunter*"

cat /etc/rkhunter.conf



looking at crons:

crontab -l			#view scheduled crons












```























